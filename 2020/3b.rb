# frozen_string_literal: true

MAP = <<~EOF
  ....#...##......##..#..#.#...#.
  ..######...#......#....#..#.##.
  ..#.#...##......#.#..#..#....#.
  ..#.....#..#.#........#.#..#..#
  #......##..###...#.#..#.....#..
  #.......##...###...#....#......
  .....##...#......##.#.#..#.##..
  .........#......#.....#......#.
  ..#.#..#....#....#......##.#.##
  .#...#..#.............#.#..#.#.
  ....#..#.#.##.#....#..#..#....#
  ...#..#.....#.......#...#..#..#
  .....#.....#.......#..#...#....
  .##.......#...#..#........#...#
  ...#.......#.#.#...#.#.#......#
  #....#..#.....#......##....#..#
  ###.#......#.#.#.#..#....#....#
  ......##......#.#...#...#..#...
  .....#......#.#.#......#.#.....
  ...##...#..#........#..#.##....
  ..##.#.#..#...###..........#.#.
  .#..#..#.....#.........#.###.#.
  ....##.....#...#...##..#.##...#
  ....#.##....#.....##......#....
  ........#.#.........#.#.......#
  #....##.#....#..#...#..........
  #..###......#....##..........##
  ....##.#.....#..#.##......#....
  #..#......#......#.............
  ...##.....##.......#.......#...
  #...#.#.....#..........#...###.
  #.....#..#.#.###...#......###..
  ...##.#......#........#..#.....
  ......#.....###.#...##........#
  .#......##......##....#....#...
  ..#.#..#.....##....#....#..#...
  ..#.#.....#.##.#.....#.....#...
  ....#.......#...#.........##...
  .#....#..#.......##.......#....
  ..#..##.....#...##.##.#.#......
  .##.#....#............#.......#
  .......#...#..#.#.##.....##..##
  ..###....#..#.##........##.#...
  ....#.#..#.....#..#.#.....#....
  ..#..#.#..............#..#.....
  .......#.#.#.........#......#..
  ...##..#.#...#......##.#.......
  #....#.#.........#...#....#..##
  .#..#.#...#.......#.#.#....#.##
  .#..###.#..#.#.....#..#........
  #.#..##.###.....##.........#..#
  #...##...#..##..#..#..........#
  .#...#..#......................
  ...##..###...........#.#...##..
  ..........#.#....#.#...........
  ..#....#....#..#....#.#.#......
  .#..#.....###......#...#...#...
  #.##..#..#.........#..#....#...
  ........#......#...#.........#.
  ..#.....#.#..##...#.#.#...##...
  ..#...........#.##..#.#..#.##..
  ..............##...#.#......#..
  #.#..#....#...##.###........#..
  .#...#..#........#........##..#
  .....##..#...#.....#.#.........
  .#...#...#....###...#.#.#..##..
  ....#.........#....###..##....#
  .#....#...####...##....####.#..
  ..#..#.......#..#......#.#.#...
  ....#....#.......##..#.#.......
  ..#....#...........##.#.##.....
  #..#..#...##.##....#.#.#.###.##
  ...#...#....#.#...##...#....###
  ......##........#.........#.#..
  ....#####..#..##.......#.#....#
  ....##..#...###....#..#.....#..
  ..#........#..#.#.....#....#...
  ..#....#......#..#...#......#..
  ...#.....##...#.#..##.....#..#.
  ...#..#.......####.##...#......
  .....#..#..#.##..##....#..#.#..
  ..#..#..##.#.#.##..#..#...#....
  ...#..........#.........#....##
  .##.....###...............#.##.
  ...##...........#.#.#......#..#
  .#...#.#.##....#....#..#.......
  .#...###.#....#..#..#..#......#
  #..#........###...........#..#.
  ..#...#......#.#.#......####.#.
  ...#.#....##.#.....#.....##....
  ...###..#.#.#...#.....#.###..#.
  .#.#..#...##......#..........#.
  ##.....#.......#.#..###...#.#..
  ##.###....#.....#.....###.#....
  #...#..##....#.#...#...#......#
  .....##.#........#.###.........
  .#..#..#.#......##.#...#.#.....
  #..#.#........##...........##.#
  #...###..#..####..#.#..........
  ..#...#....#...##.#....#....##.
  ......#.#........#.....#..#....
  #.........#...#.....#...#..##..
  #....#.........#...#.##..###.#.
  #...###...#.##.#.#.............
  #.#....#....#......#....#.#...#
  ##...#.##......#..#.#....#.....
  ....#...#.##....#..............
  .........##..........#..##..#..
  ......##....#.#......#.........
  ..#.#..............#......#..##
  ...........##.......#.#.#......
  ##...#........##.......#.#.....
  ....#...#...#....#.#......##...
  ...#..#.#.#.........#..#.#....#
  .##.#...#.#.........#.....##.#.
  #.#.....#.#.....#..............
  ..#.#..#....#..........#..##...
  ...#..#....................#..#
  ...........#...........#...#..#
  ............#...#............##
  ..#....##......##...........#..
  ..#..#..#....#....##......##.##
  ##..........#..##.##.#...#.....
  ............#..#........###.#..
  ###...##.#.#....#....#.#....#..
  ...#......##...#.......####....
  .......#..#..#.#.....#.........
  ........##.......##.....#......
  #.#...#.###....#..#...##.......
  ...#.#....#..#####.#..##.#.....
  ..#.#..##.......###...#.....#..
  ..#.......#..#...#...#..#.##...
  ......#..#.......#.....#....#..
  .......#........#.#.......##..#
  .#.#.....#.......#.......##..#.
  ..#.#....#.#.#####.....#...#...
  #..#............###.......#..#.
  ........##.........#..#...###..
  .#............##...#.....#.....
  .#..##..#....#....#.......#....
  ....##..........##.............
  .##..........#..#..#....#...#..
  ...#..#..#............####.....
  .............#..#.##..#.#.##...
  .....#........#....#.#.......#.
  ###.#..#.#...#....##...........
  ....#......#...#....##.......#.
  .......#.#...#.#...#........##.
  ..........#........#..#.##.....
  ##..#.#.....##.#...............
  .....#....#................#...
  ...##....#........##.#....#....
  .....##...###....#.#..#.......#
  .....#.#.........##....###.....
  .#.....##......#..##..##...##.#
  .#..............#.....#.#......
  .##......#..#..#......##.......
  .......#..................#....
  ...#.#...##......####.........#
  #....#####.#.#..#..#..#...#...#
  ##.#...#.......#....#...#...###
  ...#........#.....#...#.##.....
  ..##....#.......#....#.......##
  #......#..##...#..##.#.....#.#.
  ..###........#.#..#........#.#.
  ...#.###..........#.....#.#.#..
  #.###.....#...#...#..##..###...
  #....#.#.....#.#........#......
  ........#.......##.......#.....
  ...........#...#......##.......
  ............#...#....#..#.....#
  #.#.#.#....#.....#.#..........#
  #.##...#...#..#....##.#.......#
  ...#..#......#..#...##..##..#..
  #....#......#.#.....##.#..#....
  #....#..##.#......#.#.....#..##
  .#..##....##....#.#...#...#....
  #.#.###....#.#............#...#
  .#.#....#..#..........#....#.#.
  ......#..#.#...............##..
  ..#......###.#..........#.###..
  ....#.##.#..#...##..#.#...#....
  ..............#...##.......#.##
  .#...........#....#....#.##....
  #..#....#.....#...#.....##...#.
  .........#...#.##.......#...#.#
  .....#......#.........#.#..#...
  ##..........#.#..##...#.#.#....
  ##..##.#..#..#.....#.##....#...
  ........##....#.#.#....#......#
  .#.##...#.###....#.........#..#
  ..........#....###..#.........#
  #.#..#.#...#.......#..##.......
  ..#....#...###..............##.
  #..###.....####...#..#..#...#..
  ......#..#...###........###....
  ..#.....#...#.......#....###..#
  .#.........#.#.#....#.#.......#
  #.#.###.#.#...........#........
  ......#..#.........#........#..
  ...........##.#........#.#...#.
  .....#.#......##.......#.....##
  ...##...#............#..#.....#
  .....#..##....##...##.#..#.#...
  ...#...#........#.#......##....
  ........#..##..#..#......##.#..
  .#.#.....#.....#...........#.##
  .#...#.#............#......#...
  .....#...#........#....#..#.#..
  ...##....#..#...#..............
  #....##.#.#............#.......
  #..#..#.....##..#........##.#.#
  ##..#.#....#....##.......###..#
  .#.#.#.....###.....#.#......###
  .....#..#...###...#....#.#...#.
  .##.....................##....#
  .#.....#.........#....#.....##.
  #...#....#.#...###.......#.#..#
  ...#.................#.#....#.#
  .##...#.#......................
  .##.#........#...##............
  .#....#.....#.........#.##..##.
  #......#...##..#.........##.##.
  ......#......#...####..#.##....
  .###....#..##......#.##......#.
  ..#...#....#..#.......#.#......
  #....#...#.................#.#.
  ....#.#.#..#...#..#.......#.#.#
  #.#...##.......#.....##.#......
  #.........#.....##..##..#......
  ....#..##..#.....#..#..#.#..#..
  ......#.#..#.#.#....#.#.......#
  .##......#..#....##...##..#....
  ..#..#......#...##..#.##.....#.
  ..#..#.......#.#....#.....#...#
  ....#.#.....###...#.......#.#..
  ..#....##.....##.#........##...
  #...............##....#.....##.
  .#.........#....#...##.###.##.#
  .#.##..#.............#.#.#..#..
  .#.....#.................##....
  ..####.........#.#......#.#..#.
  #.......#..........#.#........#
  .#.#...##.....#.#.......#....#.
  ..#.##.#.......###....#....#...
  .#....##.............##.#.#.#..
  #.#.....#.#.#.#..#......##..#..
  .............#..........#.#.#..
  ...#.#.............#.#...##....
  .......#..#.#.......#..#.#....#
  .............#.........###..#..
  .#.#..#....#.....#..#.....#...#
  #.....#....##..##.#..#........#
  ..##..###.....##....#.#..#.....
  ..#...##....#...#.#..........#.
  ...##..##.#.....#....#.........
  ..#...#........##.#..#........#
  #.............#.###......#.##..
  .#...#........#...........#...#
  ..##.......#.#..##.##......#...
  ...#.#...##....##..#...........
  .#......##........#....##....#.
  .........#..#....#...#..##.##..
  ....#..#.#...#.......#.#.##....
  ...#.#......#.#..#..#.#....#..#
  .......#........#.........###..
  #.#..#.#.........##............
  ##..##..#.##..###...#.#...#....
  .#....#.#..#...#....#.##.....#.
  .#.#.#.#........##...#..#.#.##.
  .#..#.#..#...........#..#......
  ..#.##.#...#....#.........#...#
  .....##...#.#...#...#....#.....
  ..#..........#.#.#.......##.#..
  #.#............#..#.....#..#...
  ..#...........##.#.##.#....#..#
  #..####.....#............#.....
  .##......#####.#..#.....#....#.
  ...##..#.#......#.#..#..#...##.
  #....................#.##...#.#
  ...#............#.............#
  ....#.##..........#.....#......
  ....##..##....#.#..............
  ...........#....##.#.....#.....
  ....#.....#....#....#......#...
  #...##........#...#........#.#.
  ........#.....##..#.##.#..#.#.#
  ....##......##....#.....##....#
  ...#.#........##.......#...##..
  #......##..#.#.#....##......#..
  ..#.......#.......##..#.##.....
  .#...#...#.#.............##....
  ......#.#.#.........##...#..#.#
  .....#..####....#.##..........#
  ...#...#.#....#.....#..#.....##
  .........#.......#......###....
  ........##..##..#.#.#...###...#
  .#..##.#....#...##.....#.#.#...
  ........##...#...##..#.........
  .........#.......#.##..#...####
  #......#.....#..............#.#
  ##..##.#.##.....##...........#.
  #.............#.........#......
  ...####.#.##..#.#.#.##.#......#
  ..#.....##....#...#............
  #..............#......#...###..
  ..#..#.#...#.##.........##.....
  ..#...##..#........#..#.##..##.
  ......###...#..#....#..#.###...
  ...##.##.###.....##.#.......#..
  #....#..###..#.......#.#.#..#..
  ..##.............##..##...###.#
  .#.#..#.........#..........#...
  .........#.#.....##...#..#...##
  ....#..#....#####..#...#..#....
  ...#.....#.....#...#.#..#.#....
  .#..#.............#.......##.#.
  ...##.......#.#.....##......#..
  ...........##..#.##..###...#.#.
  ...........#...........#...#..#
  ..#....#.##.#..#..#...........#
  ..#.....##...#......#...#......
  ...###.###.....##..........#..#
EOF

SLOPES = [
  { x: 1, y: 1 },
  { x: 3, y: 1 },
  { x: 5, y: 1 },
  { x: 7, y: 1 },
  { x: 1, y: 2 }
].freeze

class TreeFinder
  def initialize(map, slope)
    @map   = map
    @slope = slope
    @x_pos = 1
    @trees = 0
  end

  def run
    @map.split("\n").each_with_index do |row, index|
      next if @slope[:y] == 2 && index.odd?

      @x_pos -= row.length if @x_pos > row.length
      @trees += 1 if row[@x_pos - 1] == "#"
      @x_pos += @slope[:x]
    end

    @trees
  end
end

puts SLOPES.reduce(1) { |product, slope| product * TreeFinder.new(MAP, slope).run }
